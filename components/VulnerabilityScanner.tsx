
import React, { useState, useEffect } from 'react';
import { ShieldCheck, Loader2, Zap, Wifi, Bluetooth, Phone, Database } from 'lucide-react';

const VulnerabilityScanner: React.FC = () => {
  const [scanning, setScanning] = useState(false);
  const [progress, setProgress] = useState(0);
  const [logs, setLogs] = useState<string[]>([]);
  const [findings, setFindings] = useState<any[]>([]);

  const startScan = () => {
    setScanning(true);
    setProgress(0);
    setLogs([]);
    setFindings([]);
  };

  useEffect(() => {
    if (!scanning) return;

    const scanSteps = [
      "Initializing heuristic engine...",
      "Mapping local wireless perimeter...",
      "Checking Bluetooth pairing history...",
      "Analyzing NFC proximity logs...",
      "Intercepting internal network handshakes...",
      "Evaluating SIM card authenticity tokens...",
      "Reviewing social media application permissions...",
      "Scanning for hidden remote access tools (RATs)...",
      "Compiling final integrity report..."
    ];

    let currentStep = 0;
    const interval = setInterval(() => {
      if (currentStep < scanSteps.length) {
        setLogs(prev => [scanSteps[currentStep], ...prev]);
        setProgress(Math.round(((currentStep + 1) / scanSteps.length) * 100));
        currentStep++;
      } else {
        clearInterval(interval);
        setScanning(false);
        setFindings([
          { id: 1, type: 'Network', title: 'Open Bluetooth Discovery', desc: 'Device is visible to nearby scanners.', severity: 'Medium' },
          { id: 2, type: 'Privacy', title: 'SIM Pin Inactive', desc: 'SIM swap protection is currently disabled.', severity: 'High' },
          { id: 3, type: 'System', title: 'Legacy OS Patch', desc: 'Kernel version 5.10 contains known exploits.', severity: 'Low' }
        ]);
      }
    }, 1200);

    return () => clearInterval(interval);
  }, [scanning]);

  return (
    <div className="space-y-8 animate-in slide-in-from-bottom-4 duration-500">
      <header>
        <h1 className="text-3xl font-bold tracking-tight mb-2">Vulnerability Audit</h1>
        <p className="text-slate-400">Deep scan for proximity, network, and identity threats.</p>
      </header>

      {!scanning && findings.length === 0 ? (
        <div className="glass rounded-3xl p-12 text-center border-dashed border-2 border-slate-700">
          <div className="bg-blue-600/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
            <Zap className="text-blue-500" size={40} />
          </div>
          <h2 className="text-2xl font-bold mb-3">Ready for System Audit</h2>
          <p className="text-slate-400 max-w-md mx-auto mb-8">
            ShieldGuard will analyze your device communications to identify if you are vulnerable to 
            phone-number-based hijacking or proximity sniffing.
          </p>
          <button 
            onClick={startScan}
            className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-xl font-black tracking-widest uppercase text-sm shadow-xl shadow-blue-900/40"
          >
            Initiate Secure Scan
          </button>
        </div>
      ) : (
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div className="glass rounded-2xl p-6 relative overflow-hidden h-[500px] flex flex-col">
            <div className="flex items-center justify-between mb-6 z-10">
              <h3 className="font-bold text-lg flex items-center gap-2">
                {scanning ? <Loader2 className="animate-spin text-blue-500" /> : <ShieldCheck className="text-emerald-500" />}
                {scanning ? 'Audit in Progress...' : 'Audit Complete'}
              </h3>
              <span className="mono text-blue-400 text-sm">{progress}%</span>
            </div>

            <div className="flex-1 overflow-y-auto space-y-2 mono text-xs text-slate-500 z-10">
              {logs.map((log, i) => (
                <div key={i} className={`p-2 rounded border border-transparent ${i === 0 ? 'bg-slate-900/80 text-blue-300 border-blue-500/20' : ''}`}>
                  <span className="text-slate-600 mr-2">[{new Date().toLocaleTimeString()}]</span> {log}
                </div>
              ))}
            </div>

            {scanning && <div className="scan-line"></div>}
          </div>

          <div className="space-y-4">
            <h3 className="font-bold text-lg">System Findings</h3>
            {findings.length === 0 && scanning && (
              <div className="p-8 text-center text-slate-500 italic">
                Waiting for analysis results...
              </div>
            )}
            {findings.map(f => (
              <div key={f.id} className="glass p-5 rounded-2xl border-l-4 border-l-rose-500 flex items-start gap-4">
                <div className={`p-3 rounded-xl ${f.severity === 'High' ? 'bg-rose-500/10 text-rose-500' : 'bg-amber-500/10 text-amber-500'}`}>
                  {f.type === 'Network' ? <Wifi size={24} /> : f.type === 'Privacy' ? <Phone size={24} /> : <Database size={24} />}
                </div>
                <div className="flex-1">
                  <div className="flex items-center justify-between mb-1">
                    <h4 className="font-bold text-slate-200">{f.title}</h4>
                    <span className="text-[10px] font-bold uppercase bg-slate-800 px-2 py-0.5 rounded text-slate-400">{f.severity}</span>
                  </div>
                  <p className="text-sm text-slate-400">{f.desc}</p>
                  <button className="text-xs font-bold text-blue-400 mt-3 hover:underline">Apply Mitigation Patch</button>
                </div>
              </div>
            ))}
            {!scanning && findings.length > 0 && (
              <button onClick={startScan} className="w-full py-4 rounded-xl border border-slate-800 text-slate-400 hover:bg-slate-900 transition-colors text-sm font-bold uppercase tracking-widest">
                Re-Run Full Audit
              </button>
            )}
          </div>
        </div>
      )}
    </div>
  );
};

export default VulnerabilityScanner;
